{"version":3,"sources":["webpack:///./node_modules/@jx3box/jx3box-map/src/components/Map.vue?f829","webpack:///./node_modules/@jx3box/jx3box-common/js/wiki.js","webpack:///./src/views/book/Single.vue?64b8","webpack:///./node_modules/core-js/modules/es.array.join.js","webpack:///./src/views/book/Single.vue","webpack:///./node_modules/@jx3box/jx3box-map/src/components/Map.vue","webpack:///node_modules/@jx3box/jx3box-map/src/components/Map.vue","webpack:///./node_modules/@jx3box/jx3box-map/src/components/Map.vue?12fe","webpack:///./node_modules/@jx3box/jx3box-map/src/components/Map.vue?c0ed","webpack:///src/views/book/Single.vue","webpack:///./src/views/book/Single.vue?88b6","webpack:///./src/views/book/Single.vue?7527"],"names":["getPet","petid","params","get","wiki","type","id","source_id","post_id","data","client","post","put","source_type","source","isEmpty","compatible","users","res","this","console","log","res_1","then","res_2","pet","ItemTabType","ItemTabIndex","handleMix","wikiComment","comment_id","$","uncurryThis","IndexedObject","toIndexedObject","arrayMethodIsStrict","nativeJoin","join","ES3_STRINGS","Object","STRICT_METHOD","target","proto","forced","separator","undefined","render","_vm","_c","_self","directives","name","rawName","value","loading","expression","staticClass","book","ItemID","attrs","_e","_v","_s","idKey","domProps","Desc","contentInfo","getProfessionType","ExtendProfessionID1","getOrigin","DoodadTemplateID","BookName","bookMapSite","length","parseInt","map","position","staticRenderFns","ref","style","wrapperSize","mapImg","_t","mapName","_l","datas","i","k","key","pointStyle","title","content","slot","props","mapId","default","popoverContent","width","height","computed","subId","x","y","_sub","_subScale","mapScale","mounted","window","beforeDestroy","methods","left","bottom","isPointsInRect","updateSize","component","components","Jx3boxMap","ItemIcon","SearchInput","Comment","wiki_post","is_empty","Name","bookProfession","getData","getInfo","finally","catch","loadData","supply","loadRevision","publish_url","triggerStat","postStat","bookMapInfo","isRevision","author_id","user_name","updated_at","fav_title","authors","filter","user_id","user_avatar","display_name","watch","handler"],"mappings":"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","file":"js/chunk-7daf1888.842dc6b5.js","sourcesContent":["export * from \"-!../../../../mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../vue-loader/lib/loaders/stylePostLoader.js!../../../../postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../../style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../../cache-loader/dist/cjs.js??ref--1-0!../../../../vue-loader/lib/index.js??vue-loader-options!../../../../vue-svg-inline-loader/dist/index.min.js!./Map.vue?vue&type=style&index=0&id=0651a7b8&prod&lang=less&scoped=true&\"","import { $helper, $node } from \"./https\";\n\nfunction getPet(petid, params) {\n    return $node().get(`/pet/${petid}`, {\n        params\n    });\n}\n\nconst wiki = {\n    // 获取最新攻略\n    get({ type, id }, params) {\n        return $helper().get(`/api/wiki/post`, {\n            params: {\n                ...params,\n                type,\n                source_id: id,\n            }\n        })\n    },\n    // 根据post_id获取攻略\n    getById(post_id, params) {\n        return $helper().get(`/api/wiki/post/${post_id}`, {\n            params\n        })\n    },\n    // 获取最新攻略列表\n    list({ type }, params) {\n        return $helper().get(`/api/wiki/posts/newest`, {\n            params: {\n                ...params,\n                type,\n            }\n        })\n    },\n    // 创建/更新攻略\n    post({ type, data, client }, params) {\n        return $helper().post(`/api/wiki/post`, {\n            post: {\n                ...data,\n                type,\n            },\n            client\n        }, {\n            params: params\n        })\n    },\n    // 获取历史版本\n    versions({ type, id }, params) {\n        return $helper().get(`/api/wiki/post/versions`, {\n            params: {\n                ...params,\n                type,\n                source_id: id,\n            }\n        })\n    },\n    // 获取我的百科攻略列表\n    myList(params) {\n        return $helper().get(`/api/my/wiki/posts`, {\n            params\n        })\n    },\n    // 删除我的百科攻略\n    delete(post_id) {\n        return $helper().put(`/api/my/wiki/post/${post_id}/remove`)\n    },\n    // 获取兼容攻略\n    async handleMix(source_type, source_id, client, params) {\n        let post = '';\n        let source = '';\n        let isEmpty = true;\n        let compatible = false;\n        let users = [];\n        if (client === 'std') {\n            const res = await this.get({ type: source_type, id: source_id }, { client, ...params });\n            post = res.data.data.post;\n            source = res.data.data.source;\n            users = res.data.data.users;\n            post && (isEmpty = false);\n            console.log(\"获取重制攻略\");\n            return { post, source, isEmpty, compatible, type: source_type, source_id: source_id, users };\n        } else {\n            const res_1 = await this.get({ type: source_type, id: source_id }, { client, ...params });\n            source = res_1.data.data.source;\n            post = res_1.data.data.post;\n            users = res_1.data.data.users;\n            post && (isEmpty = false);\n            console.log(\"获取缘起攻略\");\n            const data = !!res_1.data.data.post;\n            if (!data) {\n                console.log(\"兼容：获取重制攻略\");\n                return this.get({ type: source_type, id: source_id }, { client: 'std', ...params }).then(res_2 => {\n                    post = res_2.data.data.post;\n                    if (!source)\n                        source = res_2.data.data.source;\n                    post && (isEmpty = false);\n                    users = res_2.data.data.users;\n                    compatible = true;\n                    return { post, source, isEmpty, compatible, type: source_type, source_id: source_id, users };\n                });\n            }\n            return { post, source, isEmpty, compatible, type: source_type, source_id: source_id, users };\n        }\n    },\n    // 兼容怀旧服\n    async mix({ type, id, client }, params) {\n        let source_type = '';\n        let source_id = '';\n        if (type === 'cj') {\n            source_type = 'achievement';\n        } else if (type === 'pet') {\n            source_type = 'item';\n        } else {\n            source_type = type || 'achievement';\n        }\n\n        if (id) {\n            source_id = id;\n            if (type === 'pet') {\n                const res = await getPet(id, { client });\n                let pet = res.data;\n                let source_id = pet.ItemTabType + \"_\" + pet.ItemTabIndex;\n                return this.handleMix(source_type, source_id, client, params);\n            } else {\n                return this.handleMix(source_type, source_id, client, params);\n            }\n        }\n    },\n}\n\nconst wikiComment = {\n    // 百科评论列表\n    list({ type, id }, params) {\n        return $helper().get(`/api/wiki/comments`, {\n            params: {\n                ...params,\n                type,\n                source_id: id,\n            }\n        })\n    },\n    post({ data }, params) {\n        return $helper().post(`/api/wiki/comment`, {\n            ...data\n        }, {\n            params\n        })\n    },\n    // 删除我的百科评论\n    delete(comment_id) {\n        return $helper().put(`/api/my/wiki/comment/${comment_id}/remove`)\n    },\n    // 获取我的百科评论列表\n    myList(params) {\n        return $helper().get(`/api/my/wiki/comments`, {\n            params\n        })\n    }\n}\n\nexport { wiki, wikiComment };\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Single.vue?vue&type=style&index=0&id=11c24139&prod&lang=less&\"","'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = uncurryThis([].join);\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.es/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"m-book-view\"},[_c('div',{staticClass:\"m-search\"},[_c('search-input')],1),_c('div',{staticClass:\"m-book-content\"},[_c('div',{staticClass:\"w-book\"},[_c('p',{staticClass:\"u-title__warpper\"},[_c('span',{staticClass:\"u-name-icon\"},[(_vm.book.ItemID)?_c('item-icon',{attrs:{\"item_id\":_vm.book.ItemID,\"size\":36}}):_vm._e()],1),_c('span',{staticClass:\"u-title-id\"},[_vm._v(\" ID:\"+_vm._s(_vm.book.idKey)+\" \")]),_c('span',{staticClass:\"u-desc\",domProps:{\"innerHTML\":_vm._s(_vm.book.Desc)}})]),_c('div',{staticClass:\"u-info__wrapper\"},[(_vm.book.contentInfo)?_c('div',{staticClass:\"book-info__content\"},[_c('p',{staticClass:\"u-subtitle\"},[_vm._v(\"【书籍内容】\")]),_c('div',{staticClass:\"book-content\",domProps:{\"innerHTML\":_vm._s(_vm.book.contentInfo)}})]):_vm._e(),_c('div',{staticClass:\"common-info__content\"},[_c('p',{staticClass:\"u-subtitle\"},[_vm._v(\"【书籍信息】\")]),_c('div',{staticClass:\"u-book-info\"},[_c('div',{staticClass:\"u-item\"},[_vm._v(\"类型：\"+_vm._s(_vm.getProfessionType(_vm.book.ExtendProfessionID1)))]),_c('div',{staticClass:\"u-item\"},[_vm._v(\"来源：\"+_vm._s(_vm.getOrigin(_vm.book.DoodadTemplateID)))]),_c('div',{staticClass:\"u-item\"},[_vm._v(\"套书：\"+_vm._s(_vm.book.BookName))])])])])]),(_vm.bookMapSite.length)?_c('div',{staticClass:\"book-map\"},[_c('p',{staticClass:\"u-subtitle\"},[_vm._v(\"【碑铭信息】\")]),_c('jx3box-map',{attrs:{\"map-id\":parseInt(_vm.bookMapSite[0].map),\"datas\":_vm.bookMapSite[0].position}})],1):_vm._e()]),_c('div',{staticClass:\"m-comment\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"讨论\")]),_c('Comment',{attrs:{\"id\":_vm.id,\"category\":\"book\"}})],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{ref:\"component\",staticClass:\"c-map\"},[_c('div',{staticClass:\"u-map__wrapper\",style:(_vm.wrapperSize)},[_c('img',{staticClass:\"u-map-img\",attrs:{\"src\":_vm.mapImg,\"draggable\":\"false\"}}),_c('div',{staticClass:\"u-map-title__wrapper\"},[_vm._t(\"title\",function(){return [_c('div',{staticClass:\"u-map-title\"},[_vm._v(_vm._s(_vm.mapName))])]},{\"title\":_vm.mapName})],2),_vm._l((_vm.datas),function(i,k){return [_c('div',{key:k,staticClass:\"u-map-point__wrapper\",style:(_vm.pointStyle(i))},[_vm._t(\"point\",function(){return [_c('el-popover',{staticClass:\"u-map-point__popover\",attrs:{\"placement\":\"top\",\"width\":\"200\",\"trigger\":\"hover\"}},[_vm._t(\"popover\",function(){return [_c('div',[_c('div',[_vm._v(_vm._s(i.title))]),_c('div',{domProps:{\"innerHTML\":_vm._s(i.content)}})])]},{\"data\":i}),_c('span',{staticClass:\"u-map-point\",attrs:{\"slot\":\"reference\"},slot:\"reference\"})],2)]},{\"data\":i})],2)]})],2)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div ref=\"component\" class=\"c-map\">\n        <div class=\"u-map__wrapper\" :style=\"wrapperSize\">\n            <img class=\"u-map-img\" :src=\"mapImg\" draggable=\"false\" />\n            <div class=\"u-map-title__wrapper\">\n                <slot name=\"title\" v-bind:title=\"mapName\">\n                    <div class=\"u-map-title\">{{ mapName }}</div>\n                </slot>\n            </div>\n            <template v-for=\"(i, k) in datas\">\n                <div class=\"u-map-point__wrapper\" :style=\"pointStyle(i)\" :key=\"k\">\n                    <slot name=\"point\" v-bind:data=\"i\">\n                        <el-popover class=\"u-map-point__popover\" placement=\"top\" width=\"200\" trigger=\"hover\">\n                            <slot name=\"popover\" v-bind:data=\"i\">\n                                <div>\n                                    <div>{{ i.title }}</div>\n                                    <div v-html=\"i.content\"></div>\n                                </div>\n                            </slot>\n                            <span slot=\"reference\" class=\"u-map-point\"> </span>\n                        </el-popover>\n                    </slot>\n                </div>\n            </template>\n        </div>\n    </div>\n</template>\n\n<script>\nimport jx3boxData from \"@jx3box/jx3box-common/data/jx3box.json\";\nimport mapScales from \"../data/map_scales.json\";\n\nexport default {\n    name: \"Jx3boxMap\",\n    props: {\n        mapId: {\n            type: Number,\n            default: 1,\n        },\n        datas: {\n            type: Array,\n            default: () => [],\n        },\n    },\n    data() {\n        return {\n            popoverContent: \"\",\n            width: 1024,\n            height: 896,\n        };\n    },\n    computed: {\n        subId() {\n            let scales = mapScales[this.mapId];\n            if (!scales || Object.keys(scales) <= 1) return 0;\n            let _sub = 0;\n            let _subScale = 0;\n            for (let sub in scales) {\n                let rect = {\n                    x: scales[sub].StartX,\n                    y: scales[sub].StartY,\n                    width: scales[sub].Width / scales[sub].Scale,\n                    height: scales[sub].Height / scales[sub].Scale,\n                };\n                if (this.isPointsInRect(rect) && scales[sub].Scale > _subScale) {\n                    _sub = sub;\n                    _subScale = scales[sub].Scale;\n                }\n            }\n            return _sub;\n        },\n        mapName() {\n            return mapScales[this.mapId][this.subId].Name;\n        },\n        mapScale() {\n            return mapScales[this.mapId][this.subId];\n        },\n        mapImg() {\n            return `${jx3boxData.__imgPath}map/maps/map_${this.mapId}_${this.subId}.png`;\n        },\n        wrapperSize() {\n            return {\n                width: this.width + \"px\",\n                height: this.height + \"px\",\n            };\n        },\n    },\n    mounted() {\n        this.$nextTick(function () {\n            this.updateSize();\n            window.addEventListener(\"resize\", this.updateSize);\n        });\n    },\n    beforeDestroy() {\n        window.removeEventListener(\"resize\", this.updateSize);\n    },\n    methods: {\n        pointStyle(item) {\n            const scale = this.mapScale;\n            const Width = scale.Width / scale.Scale;\n            const Height = scale.Height / scale.Scale;\n            const left = ((item.x - scale.StartX) / Width) * this.width;\n            const bottom = ((item.y - scale.StartY) / Height) * this.height;\n            return {\n                left: left + \"px\",\n                bottom: bottom + \"px\",\n            };\n        },\n        isPointsInRect(rect) {\n            let points = this.datas.map((p) => {\n                return {\n                    x: p.x,\n                    y: p.y,\n                };\n            });\n            return points.every((p) => {\n                return p.x >= rect.x && p.x <= rect.x + rect.width && p.y >= rect.y && p.y <= rect.y + rect.height;\n            });\n        },\n        updateSize() {\n            this.width = this.$refs[\"component\"]?.clientWidth;\n            if (!this.width) return;\n            this.height = this.width / (1024 / 896);\n            this.$emit(\"resize\", [this.width, this.height]);\n        },\n    },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.c-map {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n\n    .u-map__wrapper {\n        display: inline-block;\n        position: relative;\n        border: 1px solid rgb(238, 238, 238);\n        box-shadow: rgb(0 0 0 / 10%) 0px 0px 3px;\n        box-sizing: border-box;\n        user-select: none;\n        height: 100%;\n\n        .u-map-img {\n            display: block;\n            width: 100%;\n            height: 100%;\n            z-index: 1;\n        }\n\n        .u-map-title__wrapper {\n            z-index: 2;\n            position: absolute;\n\n            top: 16px;\n            width: 100%;\n            display: flex;\n            justify-content: center;\n\n            .u-map-title {\n                user-select: text;\n                color: #efe;\n                font-weight: bold;\n                padding: 6px;\n                background: rgba(0, 0, 0, 0.5);\n            }\n        }\n\n        .u-map-point__wrapper {\n            z-index: 3;\n            position: absolute;\n\n            .u-map-point__popover {\n                display: block;\n                width: 10px;\n                height: 10px;\n                background: #f94343;\n                border: #efe solid 1px;\n                cursor: pointer;\n                transition: all 0.1s ease-in-out;\n                &:hover {\n                    transform: scale(1.6);\n                }\n            }\n\n            .u-map-point {\n                display: block;\n                width: 10px;\n                height: 10px;\n            }\n        }\n    }\n}\n</style>\n","import mod from \"-!../../../../cache-loader/dist/cjs.js??ref--13-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--1-0!../../../../vue-loader/lib/index.js??vue-loader-options!../../../../vue-svg-inline-loader/dist/index.min.js!./Map.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../cache-loader/dist/cjs.js??ref--13-0!../../../../thread-loader/dist/cjs.js!../../../../babel-loader/lib/index.js!../../../../cache-loader/dist/cjs.js??ref--1-0!../../../../vue-loader/lib/index.js??vue-loader-options!../../../../vue-svg-inline-loader/dist/index.min.js!./Map.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Map.vue?vue&type=template&id=0651a7b8&scoped=true&\"\nimport script from \"./Map.vue?vue&type=script&lang=js&\"\nexport * from \"./Map.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Map.vue?vue&type=style&index=0&id=0651a7b8&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0651a7b8\",\n  null\n  \n)\n\nexport default component.exports","<template>\n    <div v-loading=\"loading\" class=\"m-book-view\">\n        <div class=\"m-search\">\n            <search-input></search-input>\n        </div>\n        <div class=\"m-book-content\">\n            <div class=\"w-book\">\n                <p class=\"u-title__warpper\">\n                    <span class=\"u-name-icon\">\n                        <item-icon v-if=\"book.ItemID\" :item_id=\"book.ItemID\" :size=\"36\"></item-icon>\n                    </span>\n                    <span class=\"u-title-id\"> ID:{{ book.idKey }} </span>\n                    <span class=\"u-desc\" v-html=\"book.Desc\"></span>\n                </p>\n                <div class=\"u-info__wrapper\">\n                    <div v-if=\"book.contentInfo\" class=\"book-info__content\">\n                        <p class=\"u-subtitle\">【书籍内容】</p>\n                        <div class=\"book-content\" v-html=\"book.contentInfo\"></div>\n                    </div>\n                    <div class=\"common-info__content\">\n                        <p class=\"u-subtitle\">【书籍信息】</p>\n                        <div class=\"u-book-info\">\n                            <div class=\"u-item\">类型：{{ getProfessionType(book.ExtendProfessionID1) }}</div>\n                            <div class=\"u-item\">来源：{{ getOrigin(book.DoodadTemplateID) }}</div>\n                            <div class=\"u-item\">套书：{{ book.BookName }}</div>\n                            <!-- <div class=\"u-item\">抄录相关：</div> -->\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div v-if=\"bookMapSite.length\" class=\"book-map\">\n                <p class=\"u-subtitle\">【碑铭信息】</p>\n                <jx3box-map :map-id=\"parseInt(bookMapSite[0].map)\" :datas=\"bookMapSite[0].position\"></jx3box-map>\n            </div>\n        </div>\n        <div class=\"m-comment\">\n            <el-divider content-position=\"left\">讨论</el-divider>\n            <Comment :id=\"id\" category=\"book\" />\n        </div>\n    </div>\n</template>\n\n<script>\nimport Jx3boxMap from \"@jx3box/jx3box-map/src/components/Map.vue\";\nimport ItemIcon from \"@/components/book/common/item_icon.vue\";\nimport SearchInput from \"@/components/book/common/search_input.vue\";\nimport bookProfession from \"@/assets/data/book_profession.json\";\n// 碑铭坐标json\nimport bookMapInfoStd from \"@/assets/data/stele_std_fwd.json\";\nimport bookMapInfoOrigin from \"@/assets/data/stele_origin_fwd.json\";\n\nimport { __imgPath } from \"@jx3box/jx3box-common/data/jx3box.json\";\n\nimport { postStat } from \"@jx3box/jx3box-common/js/stat.js\";\nimport { wiki } from \"@jx3box/jx3box-common/js/wiki.js\";\n// import { getAppIcon } from \"@jx3box/jx3box-common/js/utils\";\n\nimport { publishLink, ts2str, showAvatar, iconLink } from \"@jx3box/jx3box-common/js/utils\";\n\nimport { getInfo } from \"@/service/book\";\n// import isArray from \"lodash/isArray\";\nimport Comment from \"@jx3box/jx3box-comment-ui/src/Comment.vue\";\n\nexport default {\n    name: \"bookSingle\",\n    components: { Jx3boxMap, ItemIcon, SearchInput, Comment },\n    data() {\n        return {\n            wiki_post: {\n                source: {},\n                post: null,\n            },\n            compatible: false,\n            is_empty: true,\n\n            book: {\n                idKey: \"\",\n                Name: \"\",\n                Desc: \"\",\n                BookName: \"\",\n                contentInfo: \"\",\n            },\n            loading: false,\n            bookMapSite: [], // 碑铭点位信息\n        };\n    },\n    methods: {\n        getOrigin(tempId) {\n            return tempId && this.bookMapInfo[tempId] ? \"碑铭\" : \"其它\";\n        },\n        getProfessionType(type) {\n            return bookProfession.find((item) => item.id === Number(type))\n                ? bookProfession.find((item) => item.id === Number(type)).name\n                : \"\";\n        },\n        getData() {\n            this.loading = true;\n            getInfo({\n                id: this.idKey,\n                client: this.client,\n            })\n                .then((res) => {\n                    const data = res.data;\n                    data.contentInfo = data.contents.map((item) => item.content.replace(/\\\\n/g, \"<br>\")).join(\"<br>\");\n                    if (data.DoodadTemplateID && this.bookMapInfo[data.DoodadTemplateID]) {\n                        this.bookMapSite = this.bookMapInfo[data.DoodadTemplateID];\n                        this.bookMapSite[0].position[0] = Object.assign(this.bookMapSite[0].position[0], {\n                            title: data.Name,\n                            content: `坐标：(${this.bookMapSite[0].position[0].x},${this.bookMapSite[0].position[0].y},${this.bookMapSite[0].position[0].z})`,\n                        });\n                    }\n                    this.book = data;\n                })\n                .finally(() => {\n                    this.loading = false;\n                })\n                .catch(() => {\n                    this.loading = false;\n                });\n        },\n        //百科相关\n        loadData: function () {\n            // 获取最新攻略\n            if (this.id) {\n                wiki.mix({ type: \"book\", id: this.id, client: this.client }, { supply: 1 }).then((res) => {\n                    const { post, source, compatible, isEmpty, users } = res;\n                    this.wiki_post = {\n                        post: post,\n                        source: source,\n                        users,\n                    };\n                    this.is_empty = isEmpty;\n                    this.compatible = compatible;\n                });\n            }\n            this.triggerStat();\n        },\n        loadRevision: function () {\n            // 获取指定攻略\n            wiki.getById(this.post_id, { type: \"book\" }).then((res) => {\n                this.wiki_post = res?.data?.data;\n            });\n            this.triggerStat();\n        },\n        publish_url: publishLink,\n        triggerStat: function () {\n            if (this.client == \"origin\") {\n                postStat(\"origin_book\", this.id);\n            } else {\n                postStat(\"book\", this.id);\n            }\n        },\n    },\n    mounted() {\n        this.getData();\n        if (this.post_id) {\n            this.loadRevision();\n        } else {\n            this.loadData();\n        }\n    },\n    computed: {\n        idKey: function () {\n            return this.$route.params.book_id;\n        },\n        id: function () {\n            return parseInt(this.$route.params.book_id);\n        },\n        client() {\n            return this.$store.state.client;\n        },\n        bookMapInfo() {\n            return this.client === \"std\" ? bookMapInfoStd : bookMapInfoOrigin;\n        },\n\n        //wiki相关\n        post_id: function () {\n            return this.$route.params.post_id;\n        },\n        isRevision: function () {\n            return !!this.$route.params.post_id;\n        },\n        author_id: function () {\n            return ~~this.wiki_post?.post?.user_id;\n        },\n        user_name: function () {\n            return this.wiki_post?.post?.user_nickname;\n        },\n        updated_at: function () {\n            return ts2str(this.wiki_post?.post?.updated);\n        },\n        fav_title: function () {\n            return this.wiki_post?.source?.Name;\n        },\n        authors: function () {\n            if (!this.isRevision) {\n                return (\n                    this.wiki_post?.users\n                        ?.filter((user) => user.id)\n                        ?.map((user) => {\n                            return {\n                                user_id: user.id,\n                                user_avatar: user.avatar,\n                                display_name: user.nickname,\n                            };\n                        }) || []\n                );\n            }\n            return [];\n        },\n    },\n    watch: {\n        id() {\n            this.getData();\n            this.loadData();\n        },\n        post_id: {\n            handler() {\n                this.loadRevision();\n            },\n        },\n    },\n};\n</script>\n\n<style lang=\"less\">\n@import \"~@/assets/css/book/single.less\";\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Single.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Single.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Single.vue?vue&type=template&id=11c24139&\"\nimport script from \"./Single.vue?vue&type=script&lang=js&\"\nexport * from \"./Single.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Single.vue?vue&type=style&index=0&id=11c24139&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}