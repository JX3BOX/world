(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-794bbfe3"],{"1b86":function(t,i,e){"use strict";e.d(i,"a",(function(){return a})),e.d(i,"b",(function(){return n}));var o=e("41cb");function s(t,i){return Object(o["d"])().get("/pet/"+t,{params:i})}const a={get({type:t,id:i},e){return Object(o["b"])().get("/api/wiki/post",{params:{...e,type:t,source_id:i}})},getById(t,i){return Object(o["b"])().get("/api/wiki/post/"+t,{params:i})},list({type:t},i){return Object(o["b"])().get("/api/wiki/posts/newest",{params:{...i,type:t}})},post({type:t,data:i,client:e},s){return Object(o["b"])().post("/api/wiki/post",{post:{...i,type:t},client:e},{params:s})},versions({type:t,id:i},e){return Object(o["b"])().get("/api/wiki/post/versions",{params:{...e,type:t,source_id:i}})},myList(t){return Object(o["b"])().get("/api/my/wiki/posts",{params:t})},delete(t){return Object(o["b"])().put(`/api/my/wiki/post/${t}/remove`)},async handleMix(t,i,e,o){let s="",a="",n=!0,r=!1,c=[];if("std"===e){const d=await this.get({type:t,id:i},{client:e,...o});return s=d.data.data.post,a=d.data.data.source,c=d.data.data.users,s&&(n=!1),console.log("获取重制攻略"),{post:s,source:a,isEmpty:n,compatible:r,type:t,source_id:i,users:c}}{const d=await this.get({type:t,id:i},{client:e,...o});a=d.data.data.source,s=d.data.data.post,c=d.data.data.users,s&&(n=!1),console.log("获取缘起攻略");const u=!!d.data.data.post;return u?{post:s,source:a,isEmpty:n,compatible:r,type:t,source_id:i,users:c}:(console.log("兼容：获取重制攻略"),this.get({type:t,id:i},{client:"std",...o}).then(e=>(s=e.data.data.post,a||(a=e.data.data.source),s&&(n=!1),c=e.data.data.users,r=!0,{post:s,source:a,isEmpty:n,compatible:r,type:t,source_id:i,users:c})))}},async mix({type:t,id:i,client:e},o){let a="",n="";if(a="cj"===t?"achievement":"pet"===t?"item":t||"achievement",i){if(n=i,"pet"===t){const t=await s(i,{client:e});let n=t.data,r=n.ItemTabType+"_"+n.ItemTabIndex;return this.handleMix(a,r,e,o)}return this.handleMix(a,n,e,o)}}},n={list({type:t,id:i},e){return Object(o["b"])().get("/api/wiki/comments",{params:{...e,type:t,source_id:i}})},post({data:t},i){return Object(o["b"])().post("/api/wiki/comment",{...t},{params:i})},delete(t){return Object(o["b"])().put(`/api/my/wiki/comment/${t}/remove`)},myList(t){return Object(o["b"])().get("/api/my/wiki/comments",{params:t})}}},7644:function(t,i,e){},a15b:function(t,i,e){"use strict";var o=e("23e7"),s=e("e330"),a=e("44ad"),n=e("fc6a"),r=e("a640"),c=s([].join),d=a!=Object,u=r("join",",");o({target:"Array",proto:!0,forced:d||!u},{join:function(t){return c(n(this),void 0===t?",":t)}})},a202:function(t,i,e){"use strict";e("7644")},e6b1:function(t,i,e){"use strict";e.r(i);var o=function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-book-view"},[i("div",{staticClass:"m-search"},[i("search-input")],1),i("div",{staticClass:"m-book-content"},[i("div",{staticClass:"w-book"},[i("p",{staticClass:"u-title__warpper"},[i("span",{staticClass:"u-name-icon"},[t.book.ItemID?i("item-icon",{attrs:{item_id:t.book.ItemID,size:36}}):t._e()],1),i("span",{staticClass:"u-title-id"},[t._v(" ID:"+t._s(t.book.idKey)+" ")]),i("span",{staticClass:"u-desc",domProps:{innerHTML:t._s(t.book.Desc)}})]),i("div",{staticClass:"u-info__wrapper"},[t.book.contentInfo?i("div",{staticClass:"book-info__content"},[i("p",{staticClass:"u-subtitle"},[t._v("【书籍内容】")]),i("div",{staticClass:"book-content",domProps:{innerHTML:t._s(t.book.contentInfo)}})]):t._e(),i("div",{staticClass:"common-info__content"},[i("p",{staticClass:"u-subtitle"},[t._v("【书籍信息】")]),i("div",{staticClass:"u-book-info"},[i("div",{staticClass:"u-item"},[t._v("类型："+t._s(t.getProfessionType(t.book.ExtendProfessionID1)))]),i("div",{staticClass:"u-item"},[t._v("来源："+t._s(t.getOrigin(t.book.DoodadTemplateID)))]),i("div",{staticClass:"u-item"},[t._v("套书："+t._s(t.book.BookName))]),i("div",{staticClass:"u-item"},[t._v("抄录相关：")])])])])])]),i("div",{staticClass:"m-comment"},[i("el-divider",{attrs:{"content-position":"left"}},[t._v("讨论")]),i("Comment",{attrs:{id:t.id,category:"book"}})],1)])},s=[],a=(e("7db0"),e("d3b7"),e("a9e3"),e("b0c0"),e("a15b"),e("d81d"),e("ac1f"),e("5319"),e("4de4"),e("06f9")),n=e("9412"),r=e("6b19"),c=e("fe6d"),d=e("782e"),u=(e("65c2"),e("9616")),p=e("1b86"),l=e("85e4"),m=e("1339"),b=e("23d8"),v={name:"bookSingle",components:{ItemIcon:a["a"],SearchInput:n["a"],Comment:b["a"]},data:function(){return{wiki_post:{source:{},post:null},compatible:!1,is_empty:!0,book:{idKey:"",Name:"",Desc:"",BookName:"",contentInfo:""},loading:!1,bookMapSite:[]}},methods:{getOrigin:function(t){return t&&this.bookMapInfo[t]?"碑铭":"其它"},getProfessionType:function(t){return r.find((function(i){return i.id===Number(t)}))?r.find((function(i){return i.id===Number(t)})).name:""},getData:function(){var t=this;this.loading=!0,Object(m["a"])({id:this.idKey,client:this.client}).then((function(i){var e=i.data;e.contentInfo=e.contents.map((function(t){return t.content.replace(/\\n/g,"<br>")})).join("<br>"),e.DoodadTemplateID&&t.bookMapInfo[e.DoodadTemplateID]&&(t.bookMapSite=t.bookMapInfo[e.DoodadTemplateID]),t.book=e})).finally((function(){t.loading=!1})).catch((function(){t.loading=!1}))},loadData:function(){var t=this;this.id&&p["a"].mix({type:"book",id:this.id,client:this.client},{supply:1}).then((function(i){var e=i.post,o=i.source,s=i.compatible,a=i.isEmpty,n=i.users;t.wiki_post={post:e,source:o,users:n},t.is_empty=a,t.compatible=s})),this.triggerStat()},loadRevision:function(){var t=this;p["a"].getById(this.post_id,{type:"book"}).then((function(i){var e;t.wiki_post=null===i||void 0===i||null===(e=i.data)||void 0===e?void 0:e.data})),this.triggerStat()},publish_url:l["publishLink"],triggerStat:function(){"origin"==this.client?Object(u["c"])("origin_book",this.id):Object(u["c"])("book",this.id)}},mounted:function(){this.getData(),this.post_id?this.loadRevision():this.loadData()},computed:{idKey:function(){return this.$route.params.book_id},id:function(){return parseInt(this.$route.params.book_id)},client:function(){return this.$store.state.client},bookMapInfo:function(){return"std"===this.client?c:d},post_id:function(){return this.$route.params.post_id},isRevision:function(){return!!this.$route.params.post_id},author_id:function(){var t,i;return~~(null===(t=this.wiki_post)||void 0===t||null===(i=t.post)||void 0===i?void 0:i.user_id)},user_name:function(){var t,i;return null===(t=this.wiki_post)||void 0===t||null===(i=t.post)||void 0===i?void 0:i.user_nickname},updated_at:function(){var t,i;return Object(l["ts2str"])(null===(t=this.wiki_post)||void 0===t||null===(i=t.post)||void 0===i?void 0:i.updated)},fav_title:function(){var t,i;return null===(t=this.wiki_post)||void 0===t||null===(i=t.source)||void 0===i?void 0:i.Name},authors:function(){var t,i,e;return this.isRevision?[]:(null===(t=this.wiki_post)||void 0===t||null===(i=t.users)||void 0===i||null===(e=i.filter((function(t){return t.id})))||void 0===e?void 0:e.map((function(t){return{user_id:t.id,user_avatar:t.avatar,display_name:t.nickname}})))||[]}},watch:{id:function(){this.getData(),this.loadData()},post_id:{handler:function(){this.loadRevision()}}}},f=v,h=(e("a202"),e("2877")),_=Object(h["a"])(f,o,s,!1,null,null,null);i["default"]=_.exports}}]);
//# sourceMappingURL=chunk-794bbfe3.674300f2.js.map