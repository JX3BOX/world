(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a1d91a8e"],{"06f9":function(t,e,i){"use strict";i("99af");var a=function(){var t=this,e=t._self._c;return e("el-popover",{staticClass:"u-item",attrs:{placement:"right-start",trigger:"hover","visible-arrow":!1,"popper-class":"u-item__popup"}},[e("template",{slot:"reference"},[e("div",{staticClass:"u-item__warpper",class:{background:!t.onlyIcon,is_vertical:t.vertical}},[t.onlyName?t._e():e("a",{staticClass:"u-item-icon",style:"height:".concat(t.size,"px; width:").concat(t.size,"px"),attrs:{target:"_blank",href:t.getLink("item",t.source.id)}},[e("img",{staticClass:"u-item-icon__img",style:"height:".concat(t.size,"px; width:").concat(t.size,"px"),attrs:{src:t.iconLink(t.source.IconID)}}),e("div",{staticClass:"u-item-icon__quality",style:{backgroundImage:t.item_border(t.source),opacity:5==t.source.Quality?.9:1}}),e("div",{staticClass:"u-item-icon__quest",style:{backgroundImage:t.item_border_quest(t.source)}}),1!==t.display_amount?e("span",{staticClass:"u-item-icon__count"},[t._v(t._s(t.display_amount))]):t._e()]),t.onlyIcon?t._e():e("div",{staticClass:"u-item-name",class:"e-jx3-item__q".concat(t.source.Quality)},[t._v(" "+t._s(t.source.Name)+" ")])])]),e("jx3-item",{attrs:{item:t.source}})],2)},n=[],s=(i("a9e3"),i("b64b"),i("e9c4"),i("c7fa")),o=i("4ae4"),r=i("85e4"),c=i("65c2"),u={name:"ItemIcon",data:function(){return{source:{},real_id:null,maybeBook:!1}},components:{"jx3-item":s["a"]},props:{size:{type:Number,default:28},item_id:{type:String,default:null},amount:{type:Number,default:1},onlyName:{type:Boolean,default:!1},onlyIcon:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1}},methods:{get_data:function(t){var e=this;t&&Object(o["a"])(t,this.client).then((function(t){var i=t.data,a=i.data.item;Object.keys(a).length&&(e.source=a,sessionStorage.setItem(e.cache_key,JSON.stringify(a)))})).catch((function(t){var i;400==(null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.code)&&!1===e.maybeBook&&(e.maybeBook=!0,e.real_id="".concat(e.item_id,"_").concat(e.amount))}))},iconLink:r["iconLink"],getLink:r["getLink"],item_border_quest:function(t){return t.IsQuest>0?"url(".concat(c["__imgPath"],"image/item/renwu.png)"):""},item_border:function(t){switch(t.Quality){case 3:return"url(".concat(c["__imgPath"],"image/item/blue.png)");case 4:return"url(".concat(c["__imgPath"],"image/item/purple.png)");case 5:return"url(".concat(c["__imgPath"],"image/item/orange.gif)");default:return""}}},computed:{client:function(){return this.$store.state.client},cache_key:function(){return"item-".concat(this.client,"-").concat(this.real_id)},display_amount:function(){return!1===this.maybeBook?this.amount:1}},watch:{real_id:{immediate:!0,handler:function(){var t=sessionStorage.getItem(this.cache_key);if(t)try{this.source=JSON.parse(t)}catch(e){console.log(e,"[Item]无法解析本地缓存"),this.get_data(this.real_id)}else this.get_data(this.real_id)}}},mounted:function(){this.real_id=this.item_id}},l=u,d=(i("4ea7"),i("2877")),p=Object(d["a"])(l,a,n,!1,null,null,null);e["a"]=p.exports},1339:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return o}));var a=i("41cb"),n=Object(a["d"])();function s(t){return n.get("/books",{params:t})}function o(t){return n.get("/book",{params:t})}},"1b86":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return o}));var a=i("41cb");function n(t,e){return Object(a["d"])().get("/pet/"+t,{params:e})}const s={get({type:t,id:e},i){return Object(a["b"])().get("/api/wiki/post",{params:{...i,type:t,source_id:e}})},getById(t,e){return Object(a["b"])().get("/api/wiki/post/"+t,{params:e})},list({type:t},e){return Object(a["b"])().get("/api/wiki/posts/newest",{params:{...e,type:t}})},post({type:t,data:e,client:i},n){return Object(a["b"])().post("/api/wiki/post",{post:{...e,type:t},client:i},{params:n})},versions({type:t,id:e},i){return Object(a["b"])().get("/api/wiki/post/versions",{params:{...i,type:t,source_id:e}})},myList(t){return Object(a["b"])().get("/api/my/wiki/posts",{params:t})},delete(t){return Object(a["b"])().put(`/api/my/wiki/post/${t}/remove`)},async handleMix(t,e,i,a){let n="",s="",o=!0,r=!1,c=[];if("std"===i){const u=await this.get({type:t,id:e},{client:i,...a});return n=u.data.data.post,s=u.data.data.source,c=u.data.data.users,n&&(o=!1),console.log("获取重制攻略"),{post:n,source:s,isEmpty:o,compatible:r,type:t,source_id:e,users:c}}{const u=await this.get({type:t,id:e},{client:i,...a});s=u.data.data.source,n=u.data.data.post,c=u.data.data.users,n&&(o=!1),console.log("获取缘起攻略");const l=!!u.data.data.post;return l?{post:n,source:s,isEmpty:o,compatible:r,type:t,source_id:e,users:c}:(console.log("兼容：获取重制攻略"),this.get({type:t,id:e},{client:"std",...a}).then(i=>(n=i.data.data.post,s||(s=i.data.data.source),n&&(o=!1),c=i.data.data.users,r=!0,{post:n,source:s,isEmpty:o,compatible:r,type:t,source_id:e,users:c})))}},async mix({type:t,id:e,client:i},a){let s="",o="";if(s="cj"===t?"achievement":"pet"===t?"item":t||"achievement",e){if(o=e,"pet"===t){const t=await n(e,{client:i});let o=t.data,r=o.ItemTabType+"_"+o.ItemTabIndex;return this.handleMix(s,r,i,a)}return this.handleMix(s,o,i,a)}}},o={list({type:t,id:e},i){return Object(a["b"])().get("/api/wiki/comments",{params:{...i,type:t,source_id:e}})},post({data:t},e){return Object(a["b"])().post("/api/wiki/comment",{...t},{params:e})},delete(t){return Object(a["b"])().put(`/api/my/wiki/comment/${t}/remove`)},myList(t){return Object(a["b"])().get("/api/my/wiki/comments",{params:t})}}},"226e":function(t,e,i){},"27e8":function(t,e,i){"use strict";i("226e")},"3a68":function(t,e,i){},"4ea7":function(t,e,i){"use strict";i("3a68")},"6b19":function(t){t.exports=JSON.parse('[{"id":8,"name":"阅读"},{"id":9,"name":"佛学"},{"id":10,"name":"道学"},{"id":11,"name":"杂集"}]')},"6b72":function(t,e,i){},"7ec7":function(t,e,i){"use strict";i("6b72")},9412:function(t,e,i){"use strict";i("b0c0"),i("ac1f"),i("841c");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-filter-wrap",class:"single"===t.$route.name?"can-return":""},[e("div",{staticClass:"m-return"},[e("el-button",{staticClass:"u-return-btn",on:{click:t.return_handle}},[e("i",{staticClass:"el-icon-arrow-left"}),t._v("返回")])],1),e("div",{staticClass:"m-search-input"},[e("el-input",{attrs:{placeholder:"输入书籍名称/描述，「回车」进行搜索",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[e("i",{staticClass:"el-icon-search"}),t._v(" 关键词 ")]),e("el-button",{attrs:{slot:"append"},on:{click:t.search},slot:"append"},[e("div",{staticClass:"u-input-button__normal"},[e("i",{staticClass:"el-icon-position"}),e("span",[t._v("搜索")])]),e("span",{staticClass:"u-input-button__small"},[e("i",{staticClass:"xs el-icon-search"})])])],1)],1)])},n=[],s=(i("14d9"),{name:"SearchInput",data:function(){return{keyword:""}},methods:{return_handle:function(){history.back()},search:function(t){t&&this.$router.push({name:"result",query:{keyword:this.keyword}})}},mounted:function(){}}),o=s,r=(i("7ec7"),i("2877")),c=Object(r["a"])(o,a,n,!1,null,null,null);e["a"]=c.exports},a15b:function(t,e,i){"use strict";var a=i("23e7"),n=i("e330"),s=i("44ad"),o=i("fc6a"),r=i("a640"),c=n([].join),u=s!=Object,l=r("join",",");a({target:"Array",proto:!0,forced:u||!l},{join:function(t){return c(o(this),void 0===t?",":t)}})},e6b1:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-book-view"},[e("div",{staticClass:"m-search"},[e("search-input")],1),e("div",{staticClass:"m-book-content"},[e("div",{staticClass:"w-book"},[e("p",{staticClass:"u-title__warpper"},[e("span",{staticClass:"u-name-icon"},[e("item-icon",{attrs:{item_id:t.itemID,size:36}})],1),e("span",{staticClass:"u-title-id"},[t._v(" ID:"+t._s(t.book.idKey)+" ")]),e("span",{staticClass:"u-desc",domProps:{innerHTML:t._s(t.book.Desc)}})]),e("div",{staticClass:"u-info__wrapper"},[e("div",{staticClass:"common-info__content"},[e("p",{staticClass:"u-subtitle"},[t._v("【书籍信息】")]),e("div",{staticClass:"u-book-info"},[e("div",{staticClass:"u-item"},[t._v("类型："+t._s(t.getProfessionType(t.book.ExtendProfessionID1)))]),e("div",{staticClass:"u-item"},[t._v("套书："+t._s(t.book.BookName))]),e("div",{staticClass:"u-item"},[t._v("抄录相关：")])])]),t.book.contentInfo?e("div",{staticClass:"book-info__content"},[e("p",{staticClass:"u-subtitle"},[t._v("【书籍内容】")]),e("div",{staticClass:"book-content",domProps:{innerHTML:t._s(t.book.contentInfo)}})]):t._e()])])]),e("div",{staticClass:"m-comment"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("讨论")]),e("Comment",{attrs:{id:t.id,category:"book"}})],1)])},n=[],s=(i("7db0"),i("d3b7"),i("a9e3"),i("b0c0"),i("a15b"),i("d81d"),i("ac1f"),i("5319"),i("4de4"),i("06f9")),o=i("9412"),r=i("6b19"),c=(i("65c2"),i("9616")),u=i("1b86"),l=i("85e4"),d=i("1339"),p=i("23d8"),m={name:"bookSingle",components:{ItemIcon:s["a"],SearchInput:o["a"],Comment:p["a"]},data:function(){return{wiki_post:{source:{},post:null},compatible:!1,is_empty:!0,book:{idKey:"",Name:"",Desc:"",BookName:"",contentInfo:""},loading:!1}},methods:{getProfessionType:function(t){return r.find((function(e){return e.id===Number(t)}))?r.find((function(e){return e.id===Number(t)})).name:""},getData:function(){var t=this;this.loading=!0,Object(d["a"])({id:this.idKey,client:this.client}).then((function(e){var i=e.data;i.contentInfo=i.contents.map((function(t){return t.content.replace(/\\n/g,"<br>")})).join("<br>"),t.book=i})).finally((function(){t.loading=!1})).catch((function(){t.loading=!1}))},loadData:function(){var t=this;this.id&&u["a"].mix({type:"book",id:this.id,client:this.client},{supply:1}).then((function(e){var i=e.post,a=e.source,n=e.compatible,s=e.isEmpty,o=e.users;t.wiki_post={post:i,source:a,users:o},t.is_empty=s,t.compatible=n})),this.triggerStat()},loadRevision:function(){var t=this;u["a"].getById(this.post_id,{type:"book"}).then((function(e){var i;t.wiki_post=null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data})),this.triggerStat()},publish_url:l["publishLink"],triggerStat:function(){"origin"==this.client?Object(c["c"])("origin_book",this.id):Object(c["c"])("book",this.id)}},mounted:function(){this.getData(),this.post_id?this.loadRevision():this.loadData()},computed:{itemID:function(){return this.$route.params.item_id},idKey:function(){return this.$route.params.book_id},id:function(){return parseInt(this.$route.params.book_id)},client:function(){return this.$store.state.client},post_id:function(){return this.$route.params.post_id},isRevision:function(){return!!this.$route.params.post_id},author_id:function(){var t,e;return~~(null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.user_id)},user_name:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.user_nickname},updated_at:function(){var t,e;return Object(l["ts2str"])(null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.updated)},fav_title:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.source)||void 0===e?void 0:e.Name},authors:function(){var t,e,i;return this.isRevision?[]:(null===(t=this.wiki_post)||void 0===t||null===(e=t.users)||void 0===e||null===(i=e.filter((function(t){return t.id})))||void 0===i?void 0:i.map((function(t){return{user_id:t.id,user_avatar:t.avatar,display_name:t.nickname}})))||[]}},watch:{id:function(){this.getData(),this.loadData()},post_id:{handler:function(){this.loadRevision()}}}},_=m,b=(i("27e8"),i("2877")),h=Object(b["a"])(_,a,n,!1,null,null,null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-a1d91a8e.b7f402e8.js.map